*** Settings ***
Documentation       Check Nutanix disk usage

Resource            ${CURDIR}${/}..${/}..${/}..${/}resources/import.resource

Suite Setup         Ctn Generic Suite Setup
Suite Teardown      Ctn Generic Suite Teardown
Test Timeout        120s


*** Variables ***
${CMD}      ${CENTREON_PLUGINS} --plugin=cloud::nutanix::snmp::plugin


*** Test Cases ***
diskusage ${tc}
    [Tags]    hardware    snmp
    ${command}    Catenate
    ...    ${CMD}
    ...    --mode=disk-usage
    ...    --hostname=${HOSTNAME}
    ...    --snmp-version=${SNMPVERSION}
    ...    --snmp-port=${SNMPPORT}
    ...    --snmp-community=cloud/nutanix/snmp/nutanix
    ...    ${extra_options}

    Ctn Verify Command Without Connector Output    ${command}    ${expected_result}

    Examples:      tc    extra_options                                                                   expected_result    --
            ...    1     ${EMPTY}                                                                        OK: All ControllerVM disks are ok | 'ANCIENMODE~Anonymized 013#disk.storage.space.usage.bytes'=1341861888B;;;0;22992546320466 'ANCIENMODE~Anonymized 013#disk.storage.inodes.usage.percentage'=100%;;;0; 'ANCIENMODE~Anonymized 013#disk.average.io.latency.milliseconds'=0.000ms;;;0; 'ANCIENMODE~Anonymized 013#disk.operations.iops'=0iops;;;0; 'Anonymized 020~Anonymized 227#disk.storage.space.usage.bytes'=1140613120B;;;0;22992546320466 'Anonymized 020~Anonymized 227#disk.average.io.latency.milliseconds'=0.000ms;;;0; 'Anonymized 020~Anonymized 227#disk.operations.iops'=0iops;;;0; 'Anonymized 130~Anonymized 174#disk.storage.space.usage.bytes'=1255206912B;;;0;22992546320466 'Anonymized 130~Anonymized 174#disk.average.io.latency.milliseconds'=0.000ms;;;0; 'Anonymized 130~Anonymized 174#disk.operations.iops'=0iops;;;0; 'Anonymized 174~Anonymized 141#disk.storage.space.usage.bytes'=1403506688B;;;0;22992546320466 'Anonymized 174~Anonymized 141#disk.average.io.latency.milliseconds'=0.000ms;;;0; 'Anonymized 174~Anonymized 141#disk.operations.iops'=0iops;;;0; 'Anonymized 198~Anonymized 123#disk.storage.space.usage.bytes'=1461706752B;;;0;22992546320466 'Anonymized 198~Anonymized 123#disk.average.io.latency.milliseconds'=0.000ms;;;0; 'Anonymized 198~Anonymized 123#disk.operations.iops'=0iops;;;0; 'Anonymized 250~Anonymized 021#disk.storage.space.usage.bytes'=1419866112B;;;0;22992546320466 'Anonymized 250~Anonymized 021#disk.average.io.latency.milliseconds'=0.000ms;;;0; 'Anonymized 250~Anonymized 021#disk.operations.iops'=0iops;;;0;
            ...    2      --units B                                                                      OK: All ControllerVM disks are ok | 'ANCIENMODE~Anonymized 013#disk.storage.space.usage.bytes'=1341861888B;;;0;22992546320466 'ANCIENMODE~Anonymized 013#disk.storage.inodes.usage.percentage'=100%;;;0; 'ANCIENMODE~Anonymized 013#disk.average.io.latency.milliseconds'=0.000ms;;;0; 'ANCIENMODE~Anonymized 013#disk.operations.iops'=0iops;;;0; 'Anonymized 020~Anonymized 227#disk.storage.space.usage.bytes'=1140613120B;;;0;22992546320466 'Anonymized 020~Anonymized 227#disk.average.io.latency.milliseconds'=0.000ms;;;0; 'Anonymized 020~Anonymized 227#disk.operations.iops'=0iops;;;0; 'Anonymized 130~Anonymized 174#disk.storage.space.usage.bytes'=1255206912B;;;0;22992546320466 'Anonymized 130~Anonymized 174#disk.average.io.latency.milliseconds'=0.000ms;;;0; 'Anonymized 130~Anonymized 174#disk.operations.iops'=0iops;;;0; 'Anonymized 174~Anonymized 141#disk.storage.space.usage.bytes'=1403506688B;;;0;22992546320466 'Anonymized 174~Anonymized 141#disk.average.io.latency.milliseconds'=0.000ms;;;0; 'Anonymized 174~Anonymized 141#disk.operations.iops'=0iops;;;0; 'Anonymized 198~Anonymized 123#disk.storage.space.usage.bytes'=1461706752B;;;0;22992546320466 'Anonymized 198~Anonymized 123#disk.average.io.latency.milliseconds'=0.000ms;;;0; 'Anonymized 198~Anonymized 123#disk.operations.iops'=0iops;;;0; 'Anonymized 250~Anonymized 021#disk.storage.space.usage.bytes'=1419866112B;;;0;22992546320466 'Anonymized 250~Anonymized 021#disk.average.io.latency.milliseconds'=0.000ms;;;0; 'Anonymized 250~Anonymized 021#disk.operations.iops'=0iops;;;0;
            ...    3      --filter-controllervm=ANCIENMODE                                               OK: ControllerVM 'ANCIENMODE' Disk 'Anonymized 013' state: 'online', usage total: 20.91 TB used: 1.25 GB (0.01%) free: 20.91 TB (99.99%), inodes used: 100 %, average latency: 0.000 ms, IOPs: 0 | 'ANCIENMODE~Anonymized 013#disk.storage.space.usage.bytes'=1341861888B;;;0;22992546320466 'ANCIENMODE~Anonymized 013#disk.storage.inodes.usage.percentage'=100%;;;0; 'ANCIENMODE~Anonymized 013#disk.average.io.latency.milliseconds'=0.000ms;;;0; 'ANCIENMODE~Anonymized 013#disk.operations.iops'=0iops;;;0;
            ...    4      --filter-name='Anonymized 123'                                                 OK: ControllerVM 'Anonymized 198' Disk 'Anonymized 123' state: 'online', usage total: 20.91 TB used: 1.36 GB (0.01%) free: 20.91 TB (99.99%), average latency: 0.000 ms, IOPs: 0 | 'Anonymized 198~Anonymized 123#disk.storage.space.usage.bytes'=1461706752B;;;0;22992546320466 'Anonymized 198~Anonymized 123#disk.average.io.latency.milliseconds'=0.000ms;;;0; 'Anonymized 198~Anonymized 123#disk.operations.iops'=0iops;;;0;
            ...    5      --filter-name='Anonymized 123' --free                                          OK: ControllerVM 'Anonymized 198' Disk 'Anonymized 123' state: 'online', usage total: 20.91 TB used: 1.36 GB (0.01%) free: 20.91 TB (99.99%), average latency: 0.000 ms, IOPs: 0 | 'Anonymized 198~Anonymized 123#disk.storage.space.free.bytes'=22991084613714B;;;0;22992546320466 'Anonymized 198~Anonymized 123#disk.average.io.latency.milliseconds'=0.000ms;;;0; 'Anonymized 198~Anonymized 123#disk.operations.iops'=0iops;;;0;
            ...    6      --filter-name='Anonymized 123' --critical-status='\\\%{state} =~ /online/'     CRITICAL: ControllerVM 'Anonymized 198' Disk 'Anonymized 123' state: 'online' | 'Anonymized 198~Anonymized 123#disk.storage.space.usage.bytes'=1461706752B;;;0;22992546320466 'Anonymized 198~Anonymized 123#disk.average.io.latency.milliseconds'=0.000ms;;;0; 'Anonymized 198~Anonymized 123#disk.operations.iops'=0iops;;;0;
            ...    7      --filter-name='Anonymized 123' --warning-avg-latency=1:                        WARNING: ControllerVM 'Anonymized 198' Disk 'Anonymized 123' average latency: 0.000 ms | 'Anonymized 198~Anonymized 123#disk.storage.space.usage.bytes'=1461706752B;;;0;22992546320466 'Anonymized 198~Anonymized 123#disk.average.io.latency.milliseconds'=0.000ms;1:;;0; 'Anonymized 198~Anonymized 123#disk.operations.iops'=0iops;;;0;
            ...    8      --filter-name='Anonymized 123' --critical-iops=@0:0                            CRITICAL: ControllerVM 'Anonymized 198' Disk 'Anonymized 123' IOPs: 0 | 'Anonymized 198~Anonymized 123#disk.storage.space.usage.bytes'=1461706752B;;;0;22992546320466 'Anonymized 198~Anonymized 123#disk.average.io.latency.milliseconds'=0.000ms;;;0; 'Anonymized 198~Anonymized 123#disk.operations.iops'=0iops;;@0:0;0;
            ...    9      --filter-name='Anonymized 123' --critical-usage=:0                             CRITICAL: ControllerVM 'Anonymized 198' Disk 'Anonymized 123' usage total: 20.91 TB used: 1.36 GB (0.01%) free: 20.91 TB (99.99%) | 'Anonymized 198~Anonymized 123#disk.storage.space.usage.bytes'=1461706752B;;0:0;0;22992546320466 'Anonymized 198~Anonymized 123#disk.average.io.latency.milliseconds'=0.000ms;;;0; 'Anonymized 198~Anonymized 123#disk.operations.iops'=0iops;;;0;
            ...    10     --filter-name='Anonymized 013' --critical-inodes=:1                            CRITICAL: ControllerVM 'ANCIENMODE' Disk 'Anonymized 013' inodes used: 100 % | 'ANCIENMODE~Anonymized 013#disk.storage.space.usage.bytes'=1341861888B;;;0;22992546320466 'ANCIENMODE~Anonymized 013#disk.storage.inodes.usage.percentage'=100%;;0:1;0; 'ANCIENMODE~Anonymized 013#disk.average.io.latency.milliseconds'=0.000ms;;;0; 'ANCIENMODE~Anonymized 013#disk.operations.iops'=0iops;;;0;
