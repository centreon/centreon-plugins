.. _newMessageInMessageQueue:

**********************************************************************************
Nombre de nouveau messages dans une message queue (MSGQ) filtré par ID et severité
**********************************************************************************

Description
^^^^^^^^^^^

+------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-+
| Description      | Controle le nombre de nouveaux messages dans une message queue en filtrant par ID et sevérité                                                                                            | |
+------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-+
| Fonctionnement   | Récupère tous les message et les stocks dans une base de donnée légère. Compte le nombre de nouveaus messages dont la sévérité est supérieur ou égale à celle défini dans les arguments. | |
|                  | Ok si le nombre de nouveau message est en dessous du seuil warning.                                                                                                                      | |
|                  | Warning si le nombre de nouveau message est au dessus du seuil warning.                                                                                                                  | |
|                  | Critical si le nombre de nouveau message est au dessus du seuil critical.                                                                                                                | |
+------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-+
| API utilisée     | QGYOLMSG format LSTM0100, QGYGTLE, QGYCLST                                                                                                                                               | |
+------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-+
| Autorité requise | *USE sur la messageQueue, *EXECUTE sur la messageQueue library                                                                                                                           | |
+------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-+

Arguments de la commande
^^^^^^^^^^^^^^^^^^^^^^^^

+--------------------------+--------------------------------+-----------------+----------------------------------------------------------+------------------------+
| Nom de la commande       | Nombre d'arguments             | Arguments       |                                                          |                        |
+--------------------------+--------------------------------+-----------------+----------------------------------------------------------+------------------------+
| newMessageInMessageQueue | 6                              | Arguments order | Description                                              | Exemple                |
+--------------------------+--------------------------------+-----------------+----------------------------------------------------------+------------------------+
|                          |                                | Argument 1      | Nom de la messageQueue                                   | /QSYS.LIB/QSYSOPR.MSGQ |
+--------------------------+--------------------------------+-----------------+----------------------------------------------------------+------------------------+
|                          |                                | Argument 2      | Regex filtrant sur l'ID du message                       | ^CP.*$                 |
+--------------------------+--------------------------------+-----------------+----------------------------------------------------------+------------------------+
|                          |                                | Argument 3      | Niveau de sévérité minimum pour comptabiliser le message | 60                     |
+--------------------------+--------------------------------+-----------------+----------------------------------------------------------+------------------------+
|                          |                                | Argument 4      | Niveau de sévérité maximum pour comptabiliser le message | 80                     |
|                          |                                |                 | Sévérité maximum non inclu                               |                        |
+--------------------------+--------------------------------+-----------------+----------------------------------------------------------+------------------------+
|                          |                                | Argument 5      | Seuil warning (quantité)                                 | 1                      |
+--------------------------+--------------------------------+-----------------+----------------------------------------------------------+------------------------+
|                          |                                | Argument 6      | Seuil critique (quantité)                                | 2                      |
+--------------------------+--------------------------------+-----------------+----------------------------------------------------------+------------------------+
| Métriques renvoyées      | criteriaMessage=1 newMessage=3 |                 |                                                          |                        |
+--------------------------+--------------------------------+-----------------+----------------------------------------------------------+------------------------+

Base de donnée locale
^^^^^^^^^^^^^^^^^^^^^

L'emplacement de la base de donnée locale peut etre configuré dans le fichier : /etc/centreon-connector-as400/config.properties.
La variable est : pathMsgQDB.
/!\\ Attention aux autres options dont les modifications peuvent avoir des impacts importants sur le fonctionnement du connecteur.

Consommation réseau
^^^^^^^^^^^^^^^^^^^

+-------------------------------------------------+---------------------------------+-------------------------------+
| Nombre de message présent dans la message queue | Download (as400 vers connector) | Upload (connector vers as400) |
+-------------------------------------------------+---------------------------------+-------------------------------+
| 1 (théorique)                                   | 2,26 ko                         | 66 o                          |
+-------------------------------------------------+---------------------------------+-------------------------------+
| 5000                                            | 11 mo                           | 325 ko                        |
+-------------------------------------------------+---------------------------------+-------------------------------+

Exemple de configuration
^^^^^^^^^^^^^^^^^^^^^^^^

+-----------------+-----------------------------------------+
| Nom de la macro | Valeur de la macro                      |
+-----------------+-----------------------------------------+
| CHECK           | newMessageInMessageQueue                |
+-----------------+-----------------------------------------+
| ARGS            | /QSYS.LIB/QSYSOPR.MSGQ!^CP.*$!60!80!1!2 |
+-----------------+-----------------------------------------+
