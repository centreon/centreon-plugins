.. _mode:

######################
Mode de fonctionnement
######################

Centreon-Connector-AS400 peut fonctionner en mode daemon ou en ligne de commande. 
Il est complété par un plugin Nagios de contrôle, se connectant au daemon, et chargé de transmettre les résultats à Nagios.

Ligne de commande
=================

En ligne de commande, une machine virtuelle java est démarrée à chaque exécution. Ce mode ne doit être utilisé qu'à des fins de tests, afin d'éviter une forte consommation CPU/mémoire::
  
  +-------------------------------------------------------------------------------------------------------------+
  | java -jar connector-as400-1.x.x.jar -I -H %HOST% --login %LOGIN% --password %PASSWORD% -C %CHECK% -A %ARGS% |
  +-------------------------------------------------------------------------------------------------------------+

Saisir les differents arguments :

+----------+-----------------------------------------+-------------+
| Attribut | Description                             | Exemple     |
+==========+=========================================+=============+
| HOST     | L'adresse IP ou le nom de l'hôte AS/400 | 10.30.10.30 |
+----------+-----------------------------------------+-------------+
| LOGIN    | Le nom d'utilisateur AS/400             | USER123     |
+----------+-----------------------------------------+-------------+
| PASSWORD | Le mot de passe AS/400                  | PASSWORD123 |
+----------+-----------------------------------------+-------------+
| CHECK    | La commande de check                    | cpuUsage    |
+----------+-----------------------------------------+-------------+
| ARGS     | Les arguments de la commande            | 80!90       |
+----------+-----------------------------------------+-------------+

Note : les arguments de la commande sont séparés par des « ! ».

Daemon
======

Le mode daemon permet de lancer les mêmes commandes qu'en ligne de commande sans devoir redémarrer une machine virtuelle java à chaque utilisation. 
Le daemon écoute sur un port, en attente de requête. 
Un plugin de contrôle (check_centreon_as400_generic) est disponible pour se connecter au daemon, et renvoyer un résultat au format Nagios. 
Les arguments du plugin sont similaires à ceux du programme java. Il est cependant nécessaire de préciser l'adresse et le port du daemon::
  
  +----------------------------------------------------------------------------------------------------------------------------------------------------------------+
  | check_centreon_as400_generic \-\-connector %DAEMONHOST%:%DAEMONPORT% \-\-host %HOST% \-\-user %USER% \-\-password %PASSWORD% \-\-check %CHECK% \-\-args %ARGS% |
  +----------------------------------------------------------------------------------------------------------------------------------------------------------------+

Saisir les differents arguments :

+------------+------------------------------------------------------+-------------+
| Attribut   | Description                                          | Exemple     |
+------------+------------------------------------------------------+-------------+
| DAEMONHOST | L'adresse IP ou le nom de l'hôte exécutant le daemon | 10.30.10.20 |
+------------+------------------------------------------------------+-------------+
| DAEMONPORT | Le port du daemon                                    | 8091        |
+------------+------------------------------------------------------+-------------+
| HOST       | L'adresse IP ou le nom de l'hôte AS/400              | 10.30.10.30 |
+------------+------------------------------------------------------+-------------+
| LOGIN      | Le nom d'utilisateur AS/400                          | USER123     |
+------------+------------------------------------------------------+-------------+
| PASSWORD   | Le mot de passe AS/400                               | PASSWORD123 |
+------------+------------------------------------------------------+-------------+
| CHECK      | La commande de check                                 | cpuUsage    |
+------------+------------------------------------------------------+-------------+
| ARGS       | Les arguments de la commande                         | 80!90       |
+------------+------------------------------------------------------+-------------+

Note : les arguments de la commande sont séparés par des « ! ».
