name: "test-plugins"
description: "Test plugin that are passed as parameters"
inputs:
  packages-cache-key:
    description: "The packaged plugin's cache key"
    required: true
  plugins-json-cache-key:
    description: "The cache key for plugin's json"
    required: true
  package-extension:
    description: "Either 'rpm' or 'deb'. Needed to determine the package manager command (dnf or apt-get)."
    required: true

runs:
  using: "composite"
  steps:

    - name: Get the cached plugin
      uses: actions/cache/restore@5a3ec84eff668545956fd18022155c47e93e2684 # v4.2.3
      with:
        path: ./*.${{ inputs.package-extension }}
        key: ${{ inputs.packages-cache-key }}
        fail-on-cache-miss: true

    - name: Get the cached plugins.json
      uses: actions/cache/restore@5a3ec84eff668545956fd18022155c47e93e2684 # v4.2.3
      with:
        path: ./plugins.json
        key: ${{ inputs.plugins-json-cache-key }}
        fail-on-cache-miss: true

    - name: Install, test and remove plugin
      shell: bash
      run: |
        [[ -f /.venv/bin/activate ]] && source /.venv/bin/activate
        python3 .github/scripts/test-plugins.py ${{ inputs.package-extension }}
